(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var p={exports:{}},f=typeof Reflect=="object"?Reflect:null,_=f&&typeof f.apply=="function"?f.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},h;f&&typeof f.ownKeys=="function"?h=f.ownKeys:Object.getOwnPropertySymbols?h=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:h=function(e){return Object.getOwnPropertyNames(e)};function C(r){console&&console.warn&&console.warn(r)}var w=Number.isNaN||function(e){return e!==e};function a(){a.init.call(this)}p.exports=a;p.exports.once=I;a.EventEmitter=a;a.prototype._events=void 0;a.prototype._eventsCount=0;a.prototype._maxListeners=void 0;var b=10;function v(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(r){if(typeof r!="number"||r<0||w(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");b=r}});a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};a.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||w(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function L(r){return r._maxListeners===void 0?a.defaultMaxListeners:r._maxListeners}a.prototype.getMaxListeners=function(){return L(this)};a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var s=e==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var c=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw c.context=o,c}var d=i[e];if(d===void 0)return!1;if(typeof d=="function")_(d,this,t);else for(var g=d.length,A=x(d,g),n=0;n<g;++n)_(A[n],this,t);return!0};function E(r,e,t,n){var s,i,o;if(v(t),i=r._events,i===void 0?(i=r._events=Object.create(null),r._eventsCount=0):(i.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),i=r._events),o=i[e]),o===void 0)o=i[e]=t,++r._eventsCount;else if(typeof o=="function"?o=i[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),s=L(r),s>0&&o.length>s&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=r,c.type=e,c.count=o.length,C(c)}return r}a.prototype.addListener=function(e,t){return E(this,e,t,!1)};a.prototype.on=a.prototype.addListener;a.prototype.prependListener=function(e,t){return E(this,e,t,!0)};function R(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function k(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},s=R.bind(n);return s.listener=t,n.wrapFn=s,s}a.prototype.once=function(e,t){return v(t),this.on(e,k(this,e,t)),this};a.prototype.prependOnceListener=function(e,t){return v(t),this.prependListener(e,k(this,e,t)),this};a.prototype.removeListener=function(e,t){var n,s,i,o,c;if(v(t),s=this._events,s===void 0)return this;if(n=s[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){c=n[o].listener,i=o;break}if(i<0)return this;i===0?n.shift():D(n,i),n.length===1&&(s[e]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",e,c||t)}return this};a.prototype.off=a.prototype.removeListener;a.prototype.removeAllListeners=function(e){var t,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var i=Object.keys(n),o;for(s=0;s<i.length;++s)o=i[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this};function O(r,e,t){var n=r._events;if(n===void 0)return[];var s=n[e];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?F(s):x(s,s.length)}a.prototype.listeners=function(e){return O(this,e,!0)};a.prototype.rawListeners=function(e){return O(this,e,!1)};a.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):W.call(r,e)};a.prototype.listenerCount=W;function W(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?h(this._events):[]};function x(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function D(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function F(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function I(r,e){return new Promise(function(t,n){function s(o){r.removeListener(e,i),n(o)}function i(){typeof r.removeListener=="function"&&r.removeListener("error",s),t([].slice.call(arguments))}j(r,e,i,{once:!0}),e!=="error"&&N(r,s,{once:!0})})}function N(r,e,t){typeof r.on=="function"&&j(r,"error",e,t)}function j(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function s(i){n.once&&r.removeEventListener(e,s),t(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}class U extends p.exports.EventEmitter{_node;constructor(e){super(),this._node=document.getElementById(e),this._node?.addEventListener("dragover",t=>this.handleDragOver(t),!1),this._node?.addEventListener("drop",t=>this.handleDrop(t),!1)}_preventDefault(e){e.stopPropagation(),e.preventDefault()}handleDrop(e){this._preventDefault(e),e.dataTransfer!==null&&Array.from(e.dataTransfer.files).filter(t=>t.type==="image/gif").forEach(t=>this.emit("drop",t))}handleDragOver(e){this._preventDefault(e)}}let l;const M=new Uint8Array(16);function T(){if(!l&&(l=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!l))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return l(M)}const u=[];for(let r=0;r<256;++r)u.push((r+256).toString(16).slice(1));function P(r,e=0){return(u[r[e+0]]+u[r[e+1]]+u[r[e+2]]+u[r[e+3]]+"-"+u[r[e+4]]+u[r[e+5]]+"-"+u[r[e+6]]+u[r[e+7]]+"-"+u[r[e+8]]+u[r[e+9]]+"-"+u[r[e+10]]+u[r[e+11]]+u[r[e+12]]+u[r[e+13]]+u[r[e+14]]+u[r[e+15]]).toLowerCase()}const J=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),y={randomUUID:J};function B(r,e,t){if(y.randomUUID&&!e&&!r)return y.randomUUID();r=r||{};const n=r.random||(r.rng||T)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=n[s];return e}return P(n)}class m{static readAsByteArray(e){return new Promise(t=>{let n=new FileReader;n.onload=function(s){const o=s.target.result;t(new Uint8Array(o))},n.readAsArrayBuffer(e)})}static readAsDataUrl(e){return new Promise(t=>{const n=new FileReader;n.onload=function(s){const o=s.target.result;t(o)},n.readAsDataURL(e)})}static convertToDataUrl(e,t="image/gif"){const n=new Blob([e],{type:t});return this.readAsDataUrl(n)}}class G{_jobs;_jobsWaitingForWorker;_numberOfWorkers=navigator.hardwareConcurrency||2;_workers;_availableWorkers;_busyWorkers;constructor(){this._jobs=[],this._jobsWaitingForWorker=[],this._workers=Array.from(Array(this._numberOfWorkers).keys()).map(()=>new Worker(new URL("/rustwasm-gif-vite/assets/processing.worker.964351a5.js",self.location),{type:"module"})),this._workers.forEach(e=>e.onmessage=this._handleMessage.bind(this)),this._workers.forEach(e=>e.onerror=this._handleError.bind(this)),this._availableWorkers=[...this._workers],this._busyWorkers=[]}_findJobById(e){return this._jobs.find(t=>t.id===e)}_removeJobById(e){this._jobs=this._jobs.filter(t=>t.id!==e)}_getNextWorker(){const e=this._availableWorkers.pop();if(e!==void 0)return this._busyWorkers.push(e),e}_getNextJob(){const e=this._jobsWaitingForWorker.shift();if(e!==void 0)return this._jobs.push(e),e}_makeWorkerAvailable(e){this._busyWorkers=this._busyWorkers.filter(t=>t!==e),this._availableWorkers.push(e)}_assignJobToWorker(e,t){t.postMessage(e.getMessageForWorker())}_distributeJobs(){const e=this._availableWorkers.length,t=this._jobsWaitingForWorker.length,n=Math.min(e,t);for(let s=0;s<n;++s){const i=this._getNextJob(),o=this._getNextWorker();i===void 0||o===void 0||this._assignJobToWorker(i,o)}}_handleMessage(e){const t=e.data,n=t.id,s=this._findJobById(n);if(s!==void 0)switch(t.type){case"register_progress":s.numberOfFrames=t.numberOfFrames;break;case"report_progress":s.emit("progress",{...t,numberOfFrames:s.numberOfFrames});break;case"finished":this._removeJobById(n),this._makeWorkerAvailable(e.target),this._distributeJobs(),s.emit("finished",t);break;case"error":this._removeJobById(n),this._makeWorkerAvailable(e.target),this._distributeJobs(),s.emit("error",t)}}_handleError(e){e.preventDefault(),console.error(e),console.error("An error occurred initializing the worker:",e.message,e.error)}async process(e){const t=await m.readAsByteArray(e),{name:n}=e,s=B(),i=new H(s,n,t);return this._jobsWaitingForWorker.push(i),this._distributeJobs(),i}}class H extends p.exports.EventEmitter{constructor(e,t,n){super(),this.id=e,this.name=t,this.buffer=n}numberOfFrames=0;getMessageForWorker(){const{id:e,name:t,buffer:n}=this;return{id:e,name:t,buffer:n}}}class S{constructor(e,t){this.name=e,this._root=document.getElementById(t),this._progress=document.createElement("progress"),this._progress.classList.add("gif-progress");const n=document.createElement("h3"),s=document.createTextNode(e);n.appendChild(s),this._container=document.createElement("div"),this._container.classList.add("single-result"),this._container.appendChild(n),this._container.appendChild(this._progress),this._root!==null&&(this._root.childNodes.length>0?this._root.insertBefore(this._container,this._root.childNodes[0]):this._root.appendChild(this._container))}_root;_container;_progress;updateProgress(e,t){this._progress.max=t,this._progress.value=e}_createImage(e,t){const n=document.createElement("img");n.src=e;const s=document.createElement("a");return s.href=e,s.download=t,s.appendChild(n),s}showGifs(e,t,n){this._container.removeChild(this._progress);const s=this._createImage(t,e),i=this._createImage(n,`${e}-reversed.gif`);this._container.appendChild(s),this._container.appendChild(i)}showError(e,t){this._container.removeChild(this._progress);const n=document.createElement("div");n.innerHTML=`
    <div class="error">
      It seems like I can't reverse that gif. Here are some details if you want to
      <a class="error" href="https://github.com/migerh/rustwasm-gif/issues/new">file an issue</a>:
    </div>
    <div class="error">
      ${e}
    </div>
    <div>
      ${t.replace(/\n/g,"<br />")}
    </div>`,this._container.appendChild(n)}}const K=new G,V="result-container",$=r=>async function(e){const{name:t,buffer:n,reversedBuffer:s}=e,i=await m.convertToDataUrl(n),o=await m.convertToDataUrl(s);r.showGifs(t,i,o)},q=r=>e=>{r.updateProgress(e.currentFrame,e.numberOfFrames)},z=r=>e=>{const{message:t,stack:n}=e;r.showError(t,n)},Q=new U("gif-file-drop");Q.on("drop",async function(e){const t=await K.process(e),n=new S(e.name,V);t.on("progress",q(n)),t.on("finished",$(n)),t.on("error",z(n))});
